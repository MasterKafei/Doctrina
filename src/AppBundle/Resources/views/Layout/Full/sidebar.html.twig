{% import _self as sidebar %}

{% macro item(route, text, icon, class) %}
    <li class="{% if route == app.request.attributes.get('_route') %}active{% endif %} {{ class|default('') }}">
        <a href="{{ path(route) }}">
            <i class="{{ icon }}"></i>
            <span>{{ text }}</span>
        </a>
    </li>
{% endmacro %}

{% macro itemWithSubs(startWithRoute, text, icon, subItems) %}
    {% import _self as sidebar %}
    {% set active = ''%}
    {% if startWithRoute is iterable %}
        {% for route in startWithRoute %}
            {% if app.request.attributes.get('_route') starts with route %}
                {% set active = 'active menu-open' %}
            {% endif %}
        {% endfor %}
    {% else %}
        {% if app.request.attributes.get('_route') starts with startWithRoute %}
            {% set active = 'active menu-open' %}
        {% endif %}
    {% endif %}
    <li class="treeview {{ active }}">
        <a href="#">
            <i class="{{ icon }}"></i>
            <span>{{ text }}</span>
            <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
            </span>
        </a>
        <ul class="treeview-menu">
            {% for subItem in subItems %}
                {{ sidebar.item(subItem.route, subItem.text, subItem.icon) }}
            {% endfor %}
        </ul>
    </li>
{% endmacro %}

<aside class="main-sidebar">
    <section class="sidebar">
        <div class="user-panel">
            <div class="pull-left image">
                <i class="fa fa-user"></i>
            </div>
            <div class="pull-left info">
                <p>Anonymous</p>
            </div>
        </div>
        <ul class="sidebar-menu" data-widget="tree">
            <li class="header">MAIN NAVIGATION</li>

            {{ sidebar.item(
            'app_home_home_index',
            'Home',
            'fa fa-home'
            ) }}
            {{ sidebar.itemWithSubs(
            'app_quiz',
            'Quiz',
            'fa fa-list-ol',
            [
            {
                'route': 'app_quiz_list_new',
                'text': 'New',
                'icon': 'fa fa-plus',
            },
            {
                'route': 'app_quiz_list_in_progress',
                'text': 'In progress',
                'icon': 'fa fa-list-alt',
            },
            {
                'route': 'app_quiz_list_completed',
                'text': 'Completed',
                'icon': 'fa fa-list-alt',
            }
            ]
            ) }}
            {% if is_granted('ROLE_ADMIN') %}
                <li class="header">ADMINISTRATION</li>
                {{ sidebar.itemWithSubs(
                    'app_admin_category',
                    'Category',
                    'fa fa-folder-open',
                    [
                    {
                        'route': 'app_admin_category_creation_create',
                        'text': 'New',
                        'icon': 'fa fa-plus',
                    },
                    {
                        'route': 'app_admin_category_listing_list',
                        'text': 'List',
                        'icon': 'fa fa-list-alt',
                    }
                    ]
                ) }}
                {{ sidebar.itemWithSubs(
                ['app_admin_quiz', 'app_admin_question'],
                'Quiz',
                'fa fa-list-ol',
                [
                {
                    'route': 'app_admin_quiz_creation_create',
                    'text': 'New',
                    'icon': 'fa fa-plus',
                },
                {
                    'route': 'app_admin_quiz_listing_list',
                    'text': 'List',
                    'icon': 'fa fa-list-alt',
                }
                ]
                ) }}
                {{ sidebar.itemWithSubs(
                'app_admin_user_group',
                'Group',
                'fa fa-users',
                [
                {
                    'route': 'app_admin_user_group_creation_create',
                    'text': 'New',
                    'icon': 'fa fa-plus',
                },
                {
                    'route': 'app_admin_user_group_listing_list',
                    'text': 'List',
                    'icon': 'fa fa-list-alt',
                }
                ]
                ) }}
            {% endif %}
        </ul>
    </section>
</aside>